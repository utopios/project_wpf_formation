<UserControl x:Class="GestionStock.Views.SupplierListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Text="Fournisseurs" Style="{StaticResource PageTitle}"/>

            <Button Grid.Column="1" Content="+ Nouveau fournisseur"
                    Style="{StaticResource PrimaryButton}"
                    Command="{Binding AddSupplierCommand}"/>
        </Grid>

        <!-- Filters -->
        <Border Grid.Row="1" Style="{StaticResource Card}" Margin="0,0,0,16" Padding="12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search -->
                <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,12,0">
                    <TextBox.Style>
                        <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                            <Setter Property="Tag" Value="Rechercher par nom, contact, email, tÃ©lÃ©phone..."/>
                        </Style>
                    </TextBox.Style>
                </TextBox>

                <!-- Show inactive filter -->
                <CheckBox Grid.Column="1"
                          Content="Inactifs uniquement"
                          IsChecked="{Binding ShowInactiveOnly}"
                          VerticalAlignment="Center"
                          Margin="0,0,12,0"/>

                <!-- Clear Filters -->
                <Button Grid.Column="2" Content="Effacer"
                        Style="{StaticResource SecondaryButton}"
                        Command="{Binding ClearFiltersCommand}"
                        Padding="12,8"/>
            </Grid>
        </Border>

        <!-- Suppliers DataGrid -->
        <Border Grid.Row="2" Style="{StaticResource Card}" Padding="0">
            <DataGrid ItemsSource="{Binding Suppliers}"
                      SelectedItem="{Binding SelectedSupplier}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Nom" Binding="{Binding Name}" Width="*"/>
                    <DataGridTextColumn Header="Contact" Binding="{Binding ContactName}" Width="120"/>
                    <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="180"/>
                    <DataGridTextColumn Header="TÃ©lÃ©phone" Binding="{Binding Phone}" Width="120"/>
                    <DataGridTextColumn Header="Produits" Binding="{Binding Products.Count}" Width="80"/>

                    <!-- Status Column -->
                    <DataGridTemplateColumn Header="Statut" Width="80">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="10" Padding="8,2"
                                        HorizontalAlignment="Left">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="{StaticResource SuccessBrush}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsActive}" Value="False">
                                                    <Setter Property="Background" Value="{StaticResource ErrorBrush}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock Foreground="White" FontSize="11">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Text" Value="Actif"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsActive}" Value="False">
                                                        <Setter Property="Text" Value="Inactif"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Actions Column -->
                    <DataGridTemplateColumn Header="Actions" Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Button Content="âœï¸" ToolTip="Modifier"
                                            Click="EditSupplier_Click"
                                            Tag="{Binding}"
                                            Background="Transparent" BorderThickness="0" Cursor="Hand"
                                            Margin="0,0,4,0"/>
                                    <Button Content="ðŸ—‘ï¸" ToolTip="Supprimer"
                                            Click="DeleteSupplier_Click"
                                            Tag="{Binding}"
                                            Background="Transparent" BorderThickness="0" Cursor="Hand"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Loading Overlay -->
        <Border Grid.RowSpan="3" Background="#80FFFFFF"
                Visibility="{Binding IsBusy, Converter={StaticResource BoolToVis}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="4"/>
                <TextBlock Text="Chargement..." Margin="0,12,0,0"
                           HorizontalAlignment="Center" Style="{StaticResource Caption}"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
