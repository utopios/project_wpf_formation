<UserControl x:Class="GestionStock.Views.ProductListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Text="{Binding Title}" Style="{StaticResource PageTitle}"/>

            <Button Grid.Column="1" Content="+ Nouveau produit"
                    Style="{StaticResource PrimaryButton}"
                    Command="{Binding AddProductCommand}"/>
        </Grid>

        <!-- Filters -->
        <Border Grid.Row="1" Style="{StaticResource Card}" Margin="0,0,0,16" Padding="12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search -->
                <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,12,0">
                    <TextBox.Style>
                        <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                            <Setter Property="Tag" Value="Rechercher..."/>
                        </Style>
                    </TextBox.Style>
                </TextBox>

                <!-- Category Filter -->
                <ComboBox Grid.Column="1"
                          ItemsSource="{Binding Categories}"
                          SelectedItem="{Binding SelectedCategory}"
                          DisplayMemberPath="Name"
                          Margin="0,0,12,0">
                    <ComboBox.Style>
                        <Style TargetType="ComboBox" BasedOn="{StaticResource {x:Type ComboBox}}">
                            <Setter Property="Tag" Value="Toutes les catÃ©gories"/>
                        </Style>
                    </ComboBox.Style>
                </ComboBox>

                <!-- Clear Filters -->
                <Button Grid.Column="2" Content="Effacer"
                        Style="{StaticResource SecondaryButton}"
                        Command="{Binding ClearFiltersCommand}"
                        Padding="12,8"/>
            </Grid>
        </Border>

        <!-- Products DataGrid -->
        <Border Grid.Row="2" Style="{StaticResource Card}" Padding="0">
            <DataGrid ItemsSource="{Binding Products}"
                      SelectedItem="{Binding SelectedProduct}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Code" Binding="{Binding Code}" Width="100"/>
                    <DataGridTextColumn Header="Nom" Binding="{Binding Name}" Width="*"/>
                    <DataGridTextColumn Header="CatÃ©gorie" Binding="{Binding Category.Name}" Width="120"/>
                    <DataGridTextColumn Header="Prix" Binding="{Binding UnitPrice, Converter={StaticResource Currency}}" Width="100"/>
                    <DataGridTextColumn Header="Stock" Binding="{Binding QuantityInStock}" Width="80"/>

                    <!-- Status Column -->
                    <DataGridTemplateColumn Header="Statut" Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="10" Padding="8,2"
                                        HorizontalAlignment="Left"
                                        Background="{Binding Converter={StaticResource StockStatusColor}}">
                                    <TextBlock Text="{Binding Converter={StaticResource StockStatus}}"
                                               Foreground="White" FontSize="11"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Actions Column -->
                    <DataGridTemplateColumn Header="Actions" Width="120">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Button Content="ðŸ‘ï¸" ToolTip="Voir"
                                            Click="ViewProduct_Click"
                                            Tag="{Binding}"
                                            Background="Transparent" BorderThickness="0" Cursor="Hand"
                                            Margin="0,0,4,0"/>
                                    <Button Content="âœï¸" ToolTip="Modifier"
                                            Click="EditProduct_Click"
                                            Tag="{Binding}"
                                            Background="Transparent" BorderThickness="0" Cursor="Hand"
                                            Margin="0,0,4,0"/>
                                    <Button Content="ðŸ—‘ï¸" ToolTip="Supprimer"
                                            Click="DeleteProduct_Click"
                                            Tag="{Binding}"
                                            Background="Transparent" BorderThickness="0" Cursor="Hand"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Loading Overlay -->
        <Border Grid.RowSpan="3" Background="#80FFFFFF"
                Visibility="{Binding IsBusy, Converter={StaticResource BoolToVis}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="4"/>
                <TextBlock Text="Chargement..." Margin="0,12,0,0"
                           HorizontalAlignment="Center" Style="{StaticResource Caption}"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
