<Window x:Class="Demo02_DependencyProperty.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Demo02_DependencyProperty"
        Title="Demo - Dependency Properties"
        Width="600" Height="500">

    <Window.Resources>
        <!-- Style pour le NumericUpDown -->
        <Style TargetType="local:NumericUpDown">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="local:NumericUpDown">
                        <Border BorderBrush="#CCC" BorderThickness="1" CornerRadius="4">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBox x:Name="PART_TextBox"
                                         Text="{Binding Value, RelativeSource={RelativeSource TemplatedParent}, StringFormat=F2}"
                                         VerticalContentAlignment="Center"
                                         Padding="8,4"
                                         BorderThickness="0"/>

                                <StackPanel Grid.Column="1">
                                    <Button Content="▲" Padding="8,2"
                                            Click="Increment_Click"
                                            BorderThickness="0" Background="#F0F0F0"/>
                                    <Button Content="▼" Padding="8,2"
                                            Click="Decrement_Click"
                                            BorderThickness="0" Background="#F0F0F0"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Titre -->
        <TextBlock Text="Demo Dependency Properties - NumericUpDown"
                   FontSize="20" FontWeight="Bold" Margin="0,0,0,20"/>

        <!-- Contrôle NumericUpDown -->
        <GroupBox Grid.Row="1" Header="NumericUpDown Control" Padding="10" Margin="0,0,0,10">
            <StackPanel>
                <local:NumericUpDown x:Name="NumericControl"
                                     Value="50"
                                     Minimum="0"
                                     Maximum="100"
                                     Increment="5"
                                     Width="200"
                                     HorizontalAlignment="Left"
                                     ValueChanged="NumericControl_ValueChanged"/>

                <TextBlock Margin="0,10,0,0">
                    <Run Text="Valeur actuelle: "/>
                    <Run Text="{Binding Value, ElementName=NumericControl}" FontWeight="Bold"/>
                </TextBlock>
            </StackPanel>
        </GroupBox>

        <!-- Configuration -->
        <GroupBox Grid.Row="2" Header="Configuration des propriétés" Padding="10" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Text="Minimum:" VerticalAlignment="Center" Margin="0,0,10,5"/>
                <TextBox Grid.Column="1" x:Name="MinTextBox" Text="0" Margin="0,0,20,5"
                         TextChanged="MinMax_TextChanged"/>

                <TextBlock Grid.Column="2" Text="Maximum:" VerticalAlignment="Center" Margin="0,0,10,5"/>
                <TextBox Grid.Column="3" x:Name="MaxTextBox" Text="100" Margin="0,0,0,5"
                         TextChanged="MinMax_TextChanged"/>

                <TextBlock Grid.Row="1" Text="Increment:" VerticalAlignment="Center" Margin="0,0,10,5"/>
                <TextBox Grid.Row="1" Grid.Column="1" x:Name="IncrementTextBox" Text="5" Margin="0,0,20,5"
                         TextChanged="Increment_TextChanged"/>

                <TextBlock Grid.Row="1" Grid.Column="2" Text="Set Value:" VerticalAlignment="Center" Margin="0,0,10,5"/>
                <StackPanel Grid.Row="1" Grid.Column="3" Orientation="Horizontal">
                    <TextBox x:Name="SetValueTextBox" Text="50" Width="80" Margin="0,0,10,5"/>
                    <Button Content="Set" Padding="10,2" Click="SetValue_Click"/>
                </StackPanel>

                <Button Grid.Row="2" Grid.ColumnSpan="2" Content="Tester avec NaN (invalide)"
                        Click="TestInvalid_Click" Margin="0,5,20,0"/>

                <Button Grid.Row="2" Grid.Column="2" Grid.ColumnSpan="2" Content="Tester valeur hors limites"
                        Click="TestOutOfRange_Click" Margin="0,5,0,0"/>
            </Grid>
        </GroupBox>

        <!-- Log des événements -->
        <GroupBox Grid.Row="3" Header="Log des événements (voir aussi Output Window)" Padding="10">
            <ListBox x:Name="EventLog" Height="150" FontFamily="Consolas" FontSize="11"/>
        </GroupBox>

        <!-- Démo Attached Property -->
        <GroupBox Grid.Row="4" Header="Démo Attached Property - Watermark" Padding="10" Margin="0,10,0,0">
            <StackPanel>
                <TextBlock Text="Les Attached Properties permettent d'ajouter des comportements à n'importe quel contrôle :"
                           TextWrapping="Wrap" Margin="0,0,0,10"/>

                <TextBlock Text="Exemple 1 : TextBox avec watermark" FontWeight="SemiBold" Margin="0,0,0,5"/>
                <TextBox local:WatermarkHelper.Watermark="Entrez votre nom..."
                         Width="300" HorizontalAlignment="Left" Margin="0,0,0,10"/>

                <TextBlock Text="Exemple 2 : TextBox avec watermark différent" FontWeight="SemiBold" Margin="0,0,0,5"/>
                <TextBox local:WatermarkHelper.Watermark="Entrez votre email..."
                         Width="300" HorizontalAlignment="Left" Margin="0,0,0,10"/>

                <TextBlock Text="Exemple 3 : Sans watermark" FontWeight="SemiBold" Margin="0,0,0,5"/>
                <TextBox Width="300" HorizontalAlignment="Left"/>
            </StackPanel>
        </GroupBox>

        <!-- Info -->
        <TextBlock Grid.Row="5" TextWrapping="Wrap" Margin="0,10,0,0" Foreground="Gray">
            Observez la fenêtre Output dans Visual Studio pour voir l'ordre d'exécution :
            ValidateValue → CoerceValue → OnValueChanged
        </TextBlock>
    </Grid>
</Window>
