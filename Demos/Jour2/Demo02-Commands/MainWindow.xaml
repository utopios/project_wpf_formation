<Window x:Class="CommandsDemo.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:CommandsDemo.ViewModels"
        Title="Démo - ICommand et RelayCommand"
        Height="700" Width="900"
        Background="#F5F5F5">

    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Colonne gauche: Compteur et commandes simples -->
        <StackPanel Margin="0,0,10,0">

            <!-- Section Compteur -->
            <Border Background="White" CornerRadius="8" Padding="20" Margin="0,0,0,15">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.1"/>
                </Border.Effect>

                <StackPanel>
                    <TextBlock Text="Compteur avec CanExecute"
                              FontSize="18" FontWeight="SemiBold"
                              Foreground="#2C3E50" Margin="0,0,0,15"/>

                    <!-- Affichage du compteur -->
                    <Border Background="#E3F2FD" CornerRadius="8"
                           Padding="20" HorizontalAlignment="Center"
                           Margin="0,0,0,15">
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock Text="{Binding Counter}"
                                      FontSize="48" FontWeight="Bold"
                                      Foreground="#1565C0"
                                      HorizontalAlignment="Center"/>
                            <TextBlock Text="{Binding CounterDisplay}"
                                      FontSize="14" Foreground="#64B5F6"
                                      HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Boutons de contrôle -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <Button Content="−"
                               Command="{Binding DecrementCommand}"
                               Width="50" Height="50"
                               FontSize="24" FontWeight="Bold"
                               Margin="5"/>
                        <Button Content="Reset"
                               Command="{Binding ResetCommand}"
                               Width="80" Height="50"
                               FontSize="14"
                               Margin="5"/>
                        <Button Content="+"
                               Command="{Binding IncrementCommand}"
                               Width="50" Height="50"
                               FontSize="24" FontWeight="Bold"
                               Margin="5"/>
                    </StackPanel>

                    <!-- Boutons avec paramètre -->
                    <TextBlock Text="Définir une valeur (CommandParameter):"
                              FontSize="12" Foreground="Gray"
                              Margin="0,15,0,8"/>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <Button Content="0" Width="40" Height="35"
                               Command="{Binding SetValueCommand}"
                               CommandParameter="0" Margin="3"/>
                        <Button Content="10" Width="40" Height="35"
                               Command="{Binding SetValueCommand}"
                               CommandParameter="10" Margin="3"/>
                        <Button Content="50" Width="40" Height="35"
                               Command="{Binding SetValueCommand}"
                               CommandParameter="50" Margin="3"/>
                        <Button Content="100" Width="40" Height="35"
                               Command="{Binding SetValueCommand}"
                               CommandParameter="100" Margin="3"/>
                    </StackPanel>

                    <TextBlock TextWrapping="Wrap" FontSize="11"
                              Foreground="Gray" Margin="0,15,0,0">
                        Note: Le bouton "−" est désactivé quand Counter ≤ 0.
                        Le bouton "Reset" est désactivé quand Counter = 0.
                        Ceci est géré par CanExecute.
                    </TextBlock>
                </StackPanel>
            </Border>

            <!-- Section Liste avec commandes paramétrées -->
            <Border Background="White" CornerRadius="8" Padding="20">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.1"/>
                </Border.Effect>

                <StackPanel>
                    <TextBlock Text="Liste avec CommandParameter"
                              FontSize="18" FontWeight="SemiBold"
                              Foreground="#2C3E50" Margin="0,0,0,15"/>

                    <!-- Ajout d'élément -->
                    <Grid Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBox Text="{Binding NewItem, UpdateSourceTrigger=PropertyChanged}"
                                Padding="10,8"/>
                        <Button Grid.Column="1" Content="Ajouter"
                               Command="{Binding AddItemCommand}"
                               Padding="15,8" Margin="10,0,0,0"/>
                    </Grid>

                    <!-- Liste des éléments -->
                    <ListBox ItemsSource="{Binding Items}"
                            SelectedItem="{Binding SelectedItem}"
                            Height="150" Margin="0,0,0,10">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                    <Button Grid.Column="1" Content="✕"
                                           Command="{Binding DataContext.RemoveItemCommand,
                                                     RelativeSource={RelativeSource AncestorType=Window}}"
                                           CommandParameter="{Binding}"
                                           Width="25" Height="25"
                                           FontSize="12"/>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <Button Content="Vider la liste"
                           Command="{Binding ClearListCommand}"
                           HorizontalAlignment="Left"
                           Padding="15,8"/>
                </StackPanel>
            </Border>
        </StackPanel>

        <!-- Colonne droite: Commande asynchrone -->
        <StackPanel Grid.Column="1" Margin="10,0,0,0">

            <Border Background="White" CornerRadius="8" Padding="20">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.1"/>
                </Border.Effect>

                <StackPanel>
                    <TextBlock Text="AsyncRelayCommand"
                              FontSize="18" FontWeight="SemiBold"
                              Foreground="#2C3E50" Margin="0,0,0,15"/>

                    <!-- Barre de progression -->
                    <Border Background="#F5F5F5" CornerRadius="8"
                           Padding="20" Margin="0,0,0,15">
                        <StackPanel>
                            <ProgressBar Value="{Binding Progress}"
                                        Height="20" Margin="0,0,0,10"/>
                            <TextBlock Text="{Binding Progress, StringFormat={}{0}%}"
                                      HorizontalAlignment="Center"
                                      FontWeight="SemiBold"/>
                        </StackPanel>
                    </Border>

                    <!-- Message -->
                    <TextBlock Text="{Binding Message}"
                              FontSize="14"
                              Foreground="#7F8C8D"
                              Margin="0,0,0,15"
                              TextWrapping="Wrap"
                              MinHeight="40"/>

                    <!-- Boutons -->
                    <StackPanel Orientation="Horizontal">
                        <Button Content="Charger les données"
                               Command="{Binding LoadDataCommand}"
                               Padding="15,10"
                               Margin="0,0,10,0"/>
                        <Button Content="Annuler"
                               Click="CancelButton_Click"
                               Padding="15,10"
                               IsEnabled="{Binding IsLoading}"/>
                    </StackPanel>

                    <!-- Indicateur de chargement -->
                    <StackPanel Orientation="Horizontal" Margin="0,15,0,0"
                               Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
                        <TextBlock Text="⏳" FontSize="16" Margin="0,0,8,0"/>
                        <TextBlock Text="Opération en cours..."
                                  Foreground="#F39C12" FontStyle="Italic"/>
                    </StackPanel>

                    <Border Background="#FFF3E0" CornerRadius="4"
                           Padding="15" Margin="0,20,0,0">
                        <TextBlock TextWrapping="Wrap" FontSize="11" Foreground="#E65100">
                            AsyncRelayCommand empêche les exécutions concurrentes.
                            Le bouton est automatiquement désactivé pendant l'exécution.
                            Supporte l'annulation via CancellationToken.
                        </TextBlock>
                    </Border>
                </StackPanel>
            </Border>

            <!-- Explication des commandes -->
            <Border Background="White" CornerRadius="8" Padding="20" Margin="0,15,0,0">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.1"/>
                </Border.Effect>

                <StackPanel>
                    <TextBlock Text="Résumé ICommand"
                              FontSize="16" FontWeight="SemiBold"
                              Foreground="#2C3E50" Margin="0,0,0,10"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="Execute" FontWeight="SemiBold" Margin="0,0,15,8"/>
                        <TextBlock Grid.Column="1" Text="Action à effectuer" Foreground="Gray" Margin="0,0,0,8"/>

                        <TextBlock Grid.Row="1" Text="CanExecute" FontWeight="SemiBold" Margin="0,0,15,8"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="Condition d'activation" Foreground="Gray" Margin="0,0,0,8"/>

                        <TextBlock Grid.Row="2" Text="CanExecuteChanged" FontWeight="SemiBold" Margin="0,0,15,0"/>
                        <TextBlock Grid.Row="2" Grid.Column="1" Text="Notification de changement" Foreground="Gray"/>
                    </Grid>
                </StackPanel>
            </Border>
        </StackPanel>
    </Grid>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>
</Window>
