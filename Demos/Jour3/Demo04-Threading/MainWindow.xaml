<Window x:Class="ThreadingDemo.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:ThreadingDemo.ViewModels"
        Title="Demo Threading - Thread, ThreadPool, Synchronisation, Task"
        Width="950" Height="720"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource NeutralBrush}">

    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Titre principal -->
        <StackPanel Grid.Row="0" Margin="0,0,0,15">
            <TextBlock Text="Threading en .NET" Style="{StaticResource H1Style}"/>
            <TextBlock Text="Évolution : Thread → ThreadPool → Synchronisation → Task (TPL)"
                       Style="{StaticResource MutedStyle}" Margin="0,5,0,0"/>
        </StackPanel>

        <!-- Onglets -->
        <TabControl Grid.Row="1" Padding="5">

            <!-- ============================================ -->
            <!-- TAB 1 : Thread                               -->
            <!-- ============================================ -->
            <TabItem Padding="12,6">
                <TabItem.Header>
                    <TextBlock Text="1. Thread" FontWeight="SemiBold"/>
                </TabItem.Header>
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <TextBlock Style="{StaticResource H2Style}" Text="Création manuelle de Thread"/>
                        <TextBlock Style="{StaticResource BodyStyle}" TextWrapping="Wrap" Margin="0,8,0,0"
                                   Text="La classe Thread permet d'exécuter du code sur un thread secondaire. Le Dispatcher WPF est indispensable pour mettre à jour l'interface depuis ce thread."/>

                        <Border Style="{StaticResource CardStyle}" Margin="0,15,0,0">
                            <StackPanel>
                                <WrapPanel>
                                    <Button Content="Démarrer un Thread"
                                            Command="{Binding StartThreadCommand}"
                                            Style="{StaticResource PrimaryButtonStyle}"
                                            Margin="0,0,10,0"/>
                                    <Button Content="Bloquer le UI (sans thread)"
                                            Command="{Binding FreezeUiCommand}"
                                            Style="{StaticResource DangerButtonStyle}"/>
                                </WrapPanel>

                                <TextBlock Text="Progression :" Style="{StaticResource LabelStyle}" Margin="0,15,0,0"/>
                                <Grid>
                                    <ProgressBar Value="{Binding ThreadProgress}" Maximum="100" Height="25"
                                                 Foreground="{StaticResource AccentBrush}"/>
                                    <TextBlock Text="{Binding ThreadProgress, StringFormat={}{0:0}%}"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                               FontWeight="SemiBold" FontSize="12"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <TextBlock Text="Journal d'exécution :" Style="{StaticResource LabelStyle}" Margin="0,15,0,0"/>
                        <TextBox Text="{Binding ThreadLog, Mode=OneWay}"
                                 Style="{StaticResource ConsoleStyle}"
                                 TextChanged="LogTextBox_TextChanged"
                                 Height="260"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- ============================================ -->
            <!-- TAB 2 : ThreadPool                           -->
            <!-- ============================================ -->
            <TabItem Padding="12,6">
                <TabItem.Header>
                    <TextBlock Text="2. ThreadPool" FontWeight="SemiBold"/>
                </TabItem.Header>
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <TextBlock Style="{StaticResource H2Style}" Text="ThreadPool : pool de threads gérés"/>
                        <TextBlock Style="{StaticResource BodyStyle}" TextWrapping="Wrap" Margin="0,8,0,0"
                                   Text="Le ThreadPool maintient un ensemble de threads réutilisables. Il évite le coût de création/destruction de threads et gère automatiquement le nombre de threads actifs."/>

                        <Border Style="{StaticResource CardStyle}" Margin="0,15,0,0">
                            <Button Content="Lancer 5 tâches sur le ThreadPool"
                                    Command="{Binding StartPoolCommand}"
                                    Style="{StaticResource PrimaryButtonStyle}"/>
                        </Border>

                        <TextBlock Text="Journal d'exécution :" Style="{StaticResource LabelStyle}" Margin="0,15,0,0"/>
                        <TextBox Text="{Binding PoolLog, Mode=OneWay}"
                                 Style="{StaticResource ConsoleStyle}"
                                 TextChanged="LogTextBox_TextChanged"
                                 Height="360"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- ============================================ -->
            <!-- TAB 3 : Synchronisation                      -->
            <!-- ============================================ -->
            <TabItem Padding="12,6">
                <TabItem.Header>
                    <TextBlock Text="3. Synchronisation" FontWeight="SemiBold"/>
                </TabItem.Header>
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <TextBlock Style="{StaticResource H2Style}" Text="Synchronisation entre threads"/>
                        <TextBlock Style="{StaticResource BodyStyle}" TextWrapping="Wrap" Margin="0,8,0,0"
                                   Text="Quand plusieurs threads accèdent à une ressource partagée, il faut synchroniser les accès pour éviter les race conditions. Le mot-clé lock garantit un accès exclusif."/>

                        <Border Style="{StaticResource CardStyle}" Margin="0,15,0,0">
                            <StackPanel>
                                <WrapPanel>
                                    <Button Content="Sans synchronisation"
                                            Command="{Binding StartWithoutSyncCommand}"
                                            Style="{StaticResource DangerButtonStyle}"
                                            Margin="0,0,10,0"/>
                                    <Button Content="Avec lock"
                                            Command="{Binding StartWithSyncCommand}"
                                            Style="{StaticResource SuccessButtonStyle}"/>
                                </WrapPanel>

                                <StackPanel Orientation="Horizontal" Margin="0,15,0,0">
                                    <TextBlock Text="Compteur partagé : " Style="{StaticResource H2Style}"
                                               VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding SharedCounter, StringFormat=N0}"
                                               Style="{StaticResource H1Style}"
                                               Foreground="{StaticResource PrimaryBrush}"
                                               VerticalAlignment="Center"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <TextBlock Text="Journal d'exécution :" Style="{StaticResource LabelStyle}" Margin="0,15,0,0"/>
                        <TextBox Text="{Binding SyncLog, Mode=OneWay}"
                                 Style="{StaticResource ConsoleStyle}"
                                 TextChanged="LogTextBox_TextChanged"
                                 Height="280"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- ============================================ -->
            <!-- TAB 4 : Task (TPL)                           -->
            <!-- ============================================ -->
            <TabItem Padding="12,6">
                <TabItem.Header>
                    <TextBlock Text="4. Task (TPL)" FontWeight="SemiBold"/>
                </TabItem.Header>
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <TextBlock Style="{StaticResource H2Style}" Text="Task Parallel Library (TPL)"/>
                        <TextBlock Style="{StaticResource BodyStyle}" TextWrapping="Wrap" Margin="0,8,0,0"
                                   Text="Task est l'évolution moderne du threading en .NET. Combiné avec async/await, il offre un code lisible, l'annulation coopérative (CancellationToken), le reporting de progression (IProgress&lt;T&gt;) et l'exécution parallèle (Task.WhenAll)."/>

                        <Border Style="{StaticResource CardStyle}" Margin="0,15,0,0">
                            <StackPanel>
                                <WrapPanel>
                                    <Button Content="Task.Run + async/await"
                                            Command="{Binding StartTaskCommand}"
                                            Style="{StaticResource PrimaryButtonStyle}"
                                            Margin="0,0,10,0"/>
                                    <Button Content="Task.WhenAll (parallèle)"
                                            Command="{Binding StartParallelCommand}"
                                            Style="{StaticResource SecondaryButtonStyle}"
                                            Margin="0,0,10,0"/>
                                    <Button Content="Annuler"
                                            Command="{Binding CancelTaskCommand}"
                                            Style="{StaticResource WarningButtonStyle}"/>
                                </WrapPanel>

                                <TextBlock Text="Progression :" Style="{StaticResource LabelStyle}" Margin="0,15,0,0"/>
                                <Grid>
                                    <ProgressBar Value="{Binding TaskProgress}" Maximum="100" Height="25"
                                                 Foreground="{StaticResource SuccessBrush}"/>
                                    <TextBlock Text="{Binding TaskProgress, StringFormat={}{0:0}%}"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                               FontWeight="SemiBold" FontSize="12"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <TextBlock Text="Journal d'exécution :" Style="{StaticResource LabelStyle}" Margin="0,15,0,0"/>
                        <TextBox Text="{Binding TaskLog, Mode=OneWay}"
                                 Style="{StaticResource ConsoleStyle}"
                                 TextChanged="LogTextBox_TextChanged"
                                 Height="260"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

        </TabControl>
    </Grid>
</Window>
